{% extends 'website/pc/base.html' %}
{% load static %}

{% block base_head_title %}服务邦 - {% endblock %}

{% block base_head_css %}
    <link rel="stylesheet" href="{% static 'web/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'website/css/base.css' %}">
{% endblock %}

{% block base_head_js %}
    {{ block.super }}
    <script src="{% static 'web/js/lazyload.js' %}"></script>
    <script src="{% static 'web/js/jquery.imgview.js' %}"></script>
    <script src="{% static 'web/js/base.js' %}"></script>
   <script src="{% static 'account/js/login.js' %}"></script>
{% endblock %}

{% block base_body_header %}
  <div class="login-div">
    <div class="yunye-view">
        <div class="login-center">
            <div class="login-left">
                <div class="header-circle1"></div>
                <div class="header-circle2"></div>
                <button class="login-leftbtn" type="button">登录</button>
            </div>
            <div class="login-right">
                <form method="post" class="login-form" id="btnLogin">
                    {% csrf_token %}
                    <div class="login-header">
                        <span class="header-span">登录</span>
                    </div>
                    <div class="login-text">
                        <input type="text" name="username" id="id_username"
                               placeholder="{% if open_cellphone %}邮&nbsp;箱/手机号{% else %}邮箱{% endif %}" required>
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="login-text">
                        <input type="password" name="password" id="id_password"
                               placeholder="密码" required>
                        <i class="fa fa-lock"></i>
                    </div>
                    <div class="login-rember">
                        <input type="checkbox" checked="checked" class="logincheckbox" id="btnchk">
                        <label class="login-remberpsd">记住密码</label>
                        <a href="#" class="fotgetpwd">忘记密码?</a>
                    </div>
                    <button type="button" class="btn btn-primary btn-lg btn-block"
                            id="btnok">登 入
                    </button>
                    <input type="hidden" name="next" value="{{ request.GET.next }}"/>
                </form>
                <form method="post" class="regist-form" id="btnRegist">
                    {% csrf_token %}
                    <div class="regist-header">
                        <a href="#" class="regist-tab active" data-item="server">我要提供服务</a>
                        <a href="#" class="regist-tab" data-item="consumer">我要找服务</a>
                    </div>
                    <input id = "id_user_type" name = "user_type" type= "hidden">
                    <div class="regist-text">
                        <input type="text" name="username" id="rid_username"
                               placeholder="{% if open_cellphone %}邮&nbsp;箱/手机号{% else %}邮箱{% endif %}">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="regist-text">
                        <input class="codeinput" type="text" id="id_message" name="message" maxlength="4"
                               placeholder="验证码">
                        <i class="fa fa-lock"></i>
                        <input type="button" id="btncode" class="btn btn-success"
                               value="获取验证码"/>
                        <input type="button" id="btncodeoff"
                               class="btn btn-default" value="获取验证码"/>
                    </div>
                    <div class="regist-text">
                        <input type="password" name="password1" id="id_password1" maxlength="15"
                               placeholder="请输入密码">
                        <i class="fa fa-lock"></i>
                    </div>
                    <div class="regist-text">
                        <input type="password" name="password2" id="id_password2" maxlength="15"
                               placeholder="请再次输入密码" >
                        <i class="fa fa-lock"></i>
                    </div>
                    <div class="regist-text">
                        <div class="selectserver-PC">请选择行业</div>
                        <div class="selectprovider-PC" style="display:none">我要找的服务(可多选)</div>
                    </div>
                    <div class="regist-text">
                        <span class="regist-industry">找不到行业?</span>
                        <input type="text" class="writer-category" id = "id_input_category" name="input_category" 
                               placeholder="请输入" >
                        <input type="hidden" name="main_category_id" class="regist-industryinput" 
                               id="id_main_category" value="{{ form.main_category_id.value|default_if_none:''}}">
                        <input type="hidden" name="sub_category_ids"
                               id="id_sub_category_ids" value="{{ form.sub_category_ids.value|default_if_none:'' }}">
                    </div>
                    <button type="button" class="btn btn-success btn-lg btn-block"
                            id="btnregist">注 册
                    </button>
                    <input type="hidden" name="next" value="{{ request.GET.next }}"/>
                </form>
            </div>
            <div class="psd-right">
                <div class="forget-pwd">
                    <div class="psd-div">
                        <div class="psd-hearder">
                            <span>请输入你注册的{% if open_cellphone %}邮箱/手机号{% else %}邮箱{% endif %}</span>
                        </div>
                        <div class="psd-text">
                            <input type="text" name="username" id="username"
                                   placeholder="{% if open_cellphone %}邮&nbsp;箱/手机号{% else %}邮箱{% endif %}">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="psd-text">
                            <input class="codeinput" type="text" id="message" name="message" maxlength="4"
                                   placeholder="验证码">
                            <i class="fa fa-lock"></i>
                            <input type="button" id="btncode-psd" class="btn btn-success"
                                   value="获取验证码"/>
                            <input type="button" id="btncodeoff-psd"
                                   class="btn btn-default" value="获取验证码"/>
                        </div>
                        <button type="button" class="btn btn-success btn-lg btn-block"
                                id="btnsure">找 回
                        </button>
                        <div class="rember-psd">
                            <a href="#" title="">我想起来了，去登录 </a>
                        </div>
                    </div>
                </div>
                <div class="forget-reset">
                    <form method="post" id="forgetForm" class="reset-form">
                        <div class="reset-hearder">
                            <span>重置密码</span>
                        </div>
                        <div class="list-li" style="display: none">
                            username: <p id="resetUsername"></p>
                            <input type="hidden" name="username" id="id_username"/>
                        </div>
                        <div class="reset-text">
                            <input type="password" id="password1" name="password1" placeholder="请输入新密码">
                            <i class="fa fa-lock"></i>
                        </div>
                        <div class="reset-text">
                            <input type="password" id="password2" name="password2" placeholder="请再次输入新密码">
                            <i class="fa fa-lock"></i>
                        </div>
                        <button type="button" class="btn btn-success btn-lg btn-block"
                                id="btnFpwd">找 回
                        </button>
                    </form>
                </div>
            </div>
            <div class="login-close">×</div>
        </div>
    </div>
    <div class="pc-provider" id="pc-provider">
        <div class = "pcprovider-title"><i  class="fa fa-times-circle"></i><i  class="fa fa-check-circle"></i></div>
        <div class="pcprovider-main">
            <div class="pcul-provider" id="pcul-provider">
            </div>
            <div class="pcright-provider" id="pcright-provider">
            </div>
        </div>
    </div>
    <div class="pc-server" id="pc-server">
        <div class = "pcserver-title"><i  class="fa fa-times-circle"></i><i  class="fa fa-check-circle"></i></div>
        <div class="pcserver-main">
            <div class="pcul-server" id="pcul-server">
            </div>
            <div class="pcright-server" id="pcright-server">
            </div>
        </div>
    </div>
</div>
    <!-- header start -->
    <div class="header">
        <div class="container header-top">
            <div class="logo">
                <a href="javascript:;" title="武汉云页移动科技有限公司">
                    <img src="{% static 'web/images/logo.png' %}"/>
                </a>
            </div>
            <div class="search-bar" id="searchBar">
                <form action="{% url 'posters_pc:index' %}" method="get"
                      name="search_form" id="search_form">
                    <div class="search-input clearfix">
                        <i class="icon ico-search"></i>
                        <input type="text" placeholder="搜索" name="q" id="q" value="{{ request.GET.q }}"/>
                    </div>
                    <div class="dropdown" style="display:none;">
                        <button class="btn dropdown-toggle" id="seartype" data-toggle="dropdown">
                            <i class="icon ico-menu"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu main-dropdown-menu" aria-labelledby="seartype">
                            <li>
                                <a href="javascript:void(0);">最新<i class="icon ico-right"></i></a>
                            </li>
                            <li class="active">
                                <a href="javascript:void(0);">已发布<i class="icon ico-right"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-last dropdown-toggle" id="searCat"
                                data-toggle="dropdown">
                            <i class="icon ico-pagers"></i>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu main-dropdown-menu" aria-labelledby="searCat" id="searCatoBody">
                            {% for category in categorys %}
                            <li {% if category.id|stringformat:"s" == request.GET.catId %}class="active"{% endif %}>
                                <a href="javascript:void(0);" data-id="{{ category.id }}">{{ category.name }}<i class="icon ico-right"></i></a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% for k, v in request.GET.dict.items %}
                        {% if k != 'q' and k != 'catId' %}
                            <input type="hidden" name="{{ k }}" value="{{ v }}" >
                        {% endif %}
                    {% endfor %}
                        <input type="hidden" name="catId" id="catId" value="" >
                        <div class="login-pc">
                            <a class="login-toggle" type="button">登陆</a>
                            <!-- <a class="regist-toggle" type="button">登陆</a> -->
                        </div>
                </form>
            </div>
            {% if request.user.is_authenticated %}
                <div class="head-user">
                    <button class="btn mobsearch-btn" id="searchBtn">
                        <i class="icon ico-search"></i>
                    </button>
                    <a href="javascript:void(0);">
                        <img class="lazy"
                             src="{% static 'web/images/avatar-default.png' %}"
                             data-src="{{ request.user.person.avatar.url }}"/>
                        <span class="name">{{ request.user }}</span>
                    </a>
                </div>
            {% endif %}
        </div>
        <div class="nav-bar">
            <div class="container">
                <ul class="nav nav-list">
                    <li>
                        <a href="?sort=new&q={{ request.GET.q }}&catId={{ request.GET.catId }}" {% if not request.GET.sort or request.GET.sort == 'new' %}class="active"{% endif %}>
                            最新
                        </a>
                    </li>
                    <li>
                        <a href="?sort=hot&q={{ request.GET.q }}&catId={{ request.GET.catId }}" {% if request.GET.sort == 'hot' %}class="active"{% endif %}>热门</a>
                    </li>
                    <li>
                        <a href="?sort=recommend&q={{ request.GET.q }}&catId={{ request.GET.catId }}" {% if request.GET.sort == 'recommend' %}class="active"{% endif %}>推荐</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- header end -->
{% endblock %}

{% block base_body_container_inner %}
    {% if request.user.is_authenticated %}
        <div class="main-plus">
            <a href="javascript:;" class="plus-button"></a>
        </div>
    {% endif %}
    <ul class="poster-list">
        {% for poster in poster_list %}
            <li class="poster-item">
                <div class="poster-wraper">
                    <div class="img">
                        <a href="javascript:;" data-src="{{ poster.get_absolute_url }}">
                            <img class="lazy"
                                 data-src="{% if poster.snapshot %}{{ poster.snapshot.url }}{% endif %} "/>
                        </a>
                    </div>
                    <div class="det">
                        <div class="head">
                            <span class="time">{{ poster.created_at|date:'Y-m-d' }}</span>
                            {% if request.user.is_authenticated  and request.user == poster.creator%}
                                <a href="{% url 'posters_pc:edit' poster.id %}" class="share-btn btn-edit" target="_blank"><i class="fa fa-edit"></i></a>
                            {% endif %}
                            <a href="{% url 'posters_pc:show' poster.id %}" class="share-btn btn-show" target="_blank"><i class="fa fa-eye"></i></a>
                            <a href="#" class="share-btn btn-share"><i class="icon ico-share"></i></a>
                            <a href="#" class="share-btn btn-fav"><i class="icon ico-fav"></i></a>
                        </div>
                        <div class="middle">
                            <div class="qrcode">
                                <img src="{% url 'website:code_poster' poster.id %}" />
                            </div>
                            </div>
                        <div class="bottom">
                            <div class="uimg">
                                <img src="{% static 'web/images/avatar-default.png' %}"
                                     data-src="{{ request.user.person.avatar.url }}"/>
                            </div>
                            <div class="uname">
                                <span>{{ poster.creator }}</span>
                            </div>
                            <div class="type">
                                {{ poster.main_category }}
                            </div>
                        </div>
                    </div>
                    <div class="info">
                        <span class="phone">{{ poster.mobile }}</span>
                        <span class="email">{{ poster.email }}</span>
                        <span class="address">{{ poster.address.address1 }}</span>
                        {% comment %}<span class="worktime">上午9点 - 下午6点</span>{% endcomment %}
                    </div>
                </div>
            </li>
        {% endfor %}
    </ul>
{% endblock %}

{% block base_foot_js %}
    <script>
        $(function(){
            $("#q").keyup(function (event) {
                if(event.keyCode == 13){
                    $("#search_form").submit();
                }
            });
        });
    </script>
{% endblock %}